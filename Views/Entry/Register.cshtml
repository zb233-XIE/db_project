@{
	ViewData["Title"] = "注册";
}

<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
	  <link rel="stylesheet" href="~/css/background.css">
</head>

<div class="col-sm-4 col-form-label">
	<label for="email" class="form-label">ID</label>
	<input type="text" class="form-control" id="phone" placeholder="输入自己的ID">
</div>

<div class="col-sm-4 col-form-label">
	<label for="email" class="form-label">邮箱</label>
	<input type="email" class="form-control" id="email" placeholder="name@example.com">
</div>

<div class="col-sm-4 col-form-label">
	<label for="username" class="form-label col-form-label">用户名</label>
	<input type="text" class="form-control" id="username" placeholder="输入用户名">
</div>

<div class="col-sm-4 col-form-label">
	<label for="pw1" class="form-label">密码</label>
	<input type="password" class="form-control" id="pw1" onkeyup="check()" onchange="checkValid()" placeholder="输入密码">
	<div class="invalid-feedback">
		密码无效！
	</div>
	<div class="form-text">
		密码长度在6~20之间
	</div>
</div>


<div class="col-sm-4 col-form-label">
	<input type="password" class="form-control" id="pw2" onkeyup="check()" onchange="checkSame()" placeholder="重新输入密码">
	<div class="invalid-feedback">
		密码无效！
	</div>
</div>

<div class="col-sm-4 form-check">
	<input class="form-check-input" type="radio" name="select" id="buyer" value="buyer" checked>
	<label class="form-check-label" for="buyer">
		我是买家
	</label>
</div>
<div class="col-sm-4 form-check">
	<input class="form-check-input" type="radio" name="select" id="seller" value="seller">
	<label class="form-check-label" for="seller">
		我是卖家
	</label>
</div>

<div class="form-group">
	<button type="submit" value="Create" id="reg" onclick="register()" class="btn btn-outline-primary" disabled>提交</button>
</div>

<script type="text/javascript">
	function checkValid() {
			passWordForm = $("#pw1").val();
			if (passWordForm.length < 6 || passWordForm.length > 10) {
					$("#pw1").removeClass("form-control is-valid");
					$("#pw1").addClass("form-control is-invalid");
					return false;
			}
			else {
					$("#pw1").removeClass("form-control is-invalid");
					$("#pw1").addClass("form-control is-valid");
					return true;
			}
	}

	function checkSame() {
			if ($("#pw1").val() != $("#pw2").val()) {
					$("#pw2").removeClass("form-control is-valid");
					$("#pw2").addClass("form-control is-invalid");
					return false;
			}
			else {
					$("#pw2").removeClass("form-control is-invalid");
					$("#pw2").addClass("form-control is-valid");
					return true;
			}
	}

	function check() {
			if (checkValid() && checkSame()) {
					$("#reg").attr("disabled", false);
			}
			else {
					$("#reg").attr("disabled", true);
			}
	}

	function register() {
			if ($("input[name='select']:checked").val() == "buyer") {
					$.ajax({
							type: "post",
							url: "/Entry/BuyerSignUpForm",
							async: false,
							contentType: "application/json",
							dataType: "json",
							data: JSON.stringify({ BuyerID: $("#phone").val(), Buyername: $("#username").val(), password: $("#pw1").val(), Mail: $("#email").val(), Birthday: new Date() }),
							success: function(data) {
									var jsonData = eval("(" + data + ")");
									if (jsonData.STATUS) {
											window.location.href = "/Entry/Login";
									}
									else {
											alert(jsonData.REASON);
									}
							}
					});
			}
			else {
					$.ajax({
							type: "post",
							url: "/Entry/PublisherSignUpForm",
							async: false,
							contentType: "application/json",
							dataType: "json",
							data: JSON.stringify({ PublisherID: $("#phone").val(), Publishername: $("#username").val(), password: $("#pw1").val(), HomepageURL: $("#email").val(), StartTime: new Date(),Description:"这个人很神秘，什么也没有写" }),
							success: function(data) {
									var jsonData = eval("(" + data + ")");
									if (jsonData.STATUS) {
											window.location.href = "/Entry/Login";
									}
									else {
											alert(jsonData.REASON);
									}
							}
					});
			}
	}

	function login() {
			$.ajax({
					type: "post",
					url: "/Entry/BuyerLogInForm",
					async: false,
					contentType: "application/json",
					dataType: "json",
					data: JSON.stringify({ username: $("#username").val(), password: $("#pw1").val() }),
					success: function(data) {
							alert(data);
					}
			});
	}
</script>
</html>

